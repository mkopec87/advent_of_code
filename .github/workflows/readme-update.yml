name: Update readme

on:
  push:
    branches: [ "master" ]

jobs:
  update-readme:
    strategy:
      max-parallel: 1 # to prevent too many requests to AoC API
      matrix:
        year: [ 2022, 2021, 2020, 2019, 2018, 2017, 2016, 2015 ]

    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
        with:
          ref: master

      - uses: k2bd/advent-readme-stars@v1
        with:
          userId: 1663352
          sessionCookie: ${{ secrets.AOC_SESSION }}
          year: ${{ matrix.year }}
          tableMarker: "<!--- advent_readme_stars_${{ matrix.year }} --->"

      - name: Sleep for 15 minutes # to prevent too many requests to AoC API
        run: sleep 15m
        shell: bash

      - uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: Update README stars for year ${{ matrix.year }}
